@model Course

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Tracker</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
@{
    int finalMark = 0;
    int finalMarkTo12 = 0;
}
<body>
<div class="container mt-5">
    <h1 class="text-center mb-4">@Model.Name</h1>
    @if (Model.Assignments != null && Model.Assignments.Count != 0)
    {
    <h2>Assignments</h2>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Assignment</th>
            <th>Mark</th>
            <th>Weight Achieved</th>
            <th>Weighting</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var assignment in Model.Assignments)
        {
        <tr>
            <td>@assignment.Name</td>
            <td><input type="number" class="form-control" id="assignmentMark_@assignment.Name" value="@assignment.Mark" oninput="updateAssignmentWeight('@assignment.Name', @assignment.Weight)" /></td>
            <td id="assignmentWeightAchieved_@assignment.Name">@((assignment.Mark / 100.0) * assignment.Weight)</td>
            <td>@assignment.Weight</td>
        </tr>
        }
        </tbody>
    </table>
    }

    @if (Model.Midterms != null && Model.Midterms.Count != 0)
    {
    <h2>Midterms</h2>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Midterm</th>
            <th>Mark</th>
            <th>Weight Achieved</th>
            <th>Weighting</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var midterm in Model.Midterms)
        {
        <tr>
            <td>@midterm.Name</td>
            <td><input type="number" class="form-control" id="midtermMark_@midterm.Name" value="@midterm.Mark" oninput="updateMidtermWeight('@midterm.Name', @midterm.Weight)" /></td>
            <td id="midtermWeightAchieved_@midterm.Name">@((midterm.Mark / 100.0) * midterm.Weight)</td>
            <td>@midterm.Weight</td>
        </tr>
        }
        </tbody>
    </table>
    }

    @if (Model.Final != null)
    {
    <h2>Exam</h2>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Exam</th>
            <th>Mark</th>
            <th>Weight Achieved</th>
            <th>Weighting</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>@Model.Final.Name</td>
            <td>
                <input type="number" class="form-control" id="finalMark" value="@Model.Final.Mark" oninput="updateFinalWeight()" />
            </td>
            <td id="finalWeightAchieved">
                @(Model.Final.Mark / 100.0 * Model.Final.Weight)
            </td>
            <td>@Model.Final.Weight</td>
        </tr>
        </tbody>
    </table>
    }

    <h2>Final Marks</h2>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Final Mark</th>
            <th>Final Exam Mark to 12</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td id="finalMarkSum">0</td>
            <td id="finalExamMarkTo12">0</td>
        </tr>
        </tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>

<script>
    function updateFinalWeight() {
        var mark = parseFloat(document.getElementById('finalMark').value) || 0;
        var weight = @Model.Final.Weight;
        var weightAchieved = (mark / 100.0) * weight;
        document.getElementById('finalWeightAchieved').innerText = weightAchieved.toFixed(2);
        updateFinalMarks();
    }

    function updateMidtermWeight(midtermName, weight) {
        var mark = parseFloat(document.getElementById('midtermMark_' + midtermName).value) || 0;
        var weightAchieved = (mark / 100.0) * weight;
        document.getElementById('midtermWeightAchieved_' + midtermName).innerText = weightAchieved.toFixed(2);
        updateFinalMarks();
    }

    function updateAssignmentWeight(assignmentName, weight) {
        var mark = parseFloat(document.getElementById('assignmentMark_' + assignmentName).value) || 0;
        var weightAchieved = (mark / 100.0) * weight;
        document.getElementById('assignmentWeightAchieved_' + assignmentName).innerText = weightAchieved.toFixed(2);
        updateFinalMarks();
    }

</script>
<script>
    function updateFinalMarks() {
        var finalMarkSum = 0;

        // Sum the achieved weights for assignments
        var assignments = @Html.Raw(Json.Serialize(Model.Assignments.Select(a => new { a.Name }).ToList()));
        assignments.forEach(function(assignment) {
            finalMarkSum += parseFloat(document.getElementById('assignmentWeightAchieved_' + assignment.Name).innerText) || 0;
        });

        // Sum the achieved weights for midterms
        var midterms = @Html.Raw(Json.Serialize(Model.Midterms.Select(m => new { m.Name }).ToList()));
        midterms.forEach(function(midterm) {
            finalMarkSum += parseFloat(document.getElementById('midtermWeightAchieved_' + midterm.Name).innerText) || 0;
        });

        // Add the achieved weight for the final exam
        finalMarkSum += parseFloat(document.getElementById('finalWeightAchieved').innerText) || 0;

        // Update the final mark sum in the table
        document.getElementById('finalMarkSum').innerText = finalMarkSum.toFixed(2);

        // Calculate and update the final exam mark to 12
        var finalExamWeight = @Model.Final.Weight;
        var finalExamMarkTo12 = (90 - finalMarkSum) / finalExamWeight;
        document.getElementById('finalExamMarkTo12').innerText = finalExamMarkTo12.toFixed(2);
    }
</script>

